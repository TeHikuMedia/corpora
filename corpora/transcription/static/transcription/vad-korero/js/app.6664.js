webpackJsonp([1],{"4fnQ":function(n,t,i){(n.exports=i("FZ+f")(!0)).push([n.i,"\n.Korero[data-v-3a451344] {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  font-size: 14px;\n}\nbutton.delete[data-v-3a451344]{\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  display: block;\n  border: 0px;\n  margin: 2px;\n  font-size: 0.7em;\n  color: #696969;\n  cursor: pointer;\n  outline: none;\n  background: none;\n}\n.transcription[data-v-3a451344]{\n  position: relative;\n  width: 100%;\n  margin: 20px 30px 20px 30px;\n  max-width: 500px;\n  /*margin-top: 20px; */\n  font-size: 1.5em;\n  border-radius: 8px;\n  /*box-shadow: 0px 2px 6px -2px rgba(0,0,0,1)  */\n  border: 1px solid black;\n}\n.transcription.Transcribing[data-v-3a451344]{\n  border: 0px;\n}\n.transcription .text[data-v-3a451344] {\n  padding: 15px 20px;\n}\n.transcription[data-v-3a451344]:nth-of-type(1){\n  margin-top: 40px;\n}\ndiv.transcription.Success div.text [class*=fa][data-v-3a451344]{\n  display: none;\n}\n.Korero[data-v-3a451344], .header[data-v-3a451344], .body[data-v-3a451344]{\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.body[data-v-3a451344]{\n  height: 100vh;\n  margin-top: -225px;\n}\n.header[data-v-3a451344]{\n  padding-bottom: 15px;\n  z-index: 1;\n  background-color: white;\n  padding-left: 15px;\n  padding-right: 15px;\n}\n#transcriptions[data-v-3a451344]{\n  z-index: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  overflow-y: scroll;\n  -ms-flex-wrap: nowrap;\n      flex-wrap: nowrap;\n  -webkit-overflow-scrolling: touch;\n  -ms-overflow-style: -ms-autohiding-scrollbar; \n  -webkit-box-align: center; \n      -ms-flex-align: center; \n          align-items: center;  \n  margin-top: 232px;\n  height: 100vh;    \n  padding-left: 15px;\n  padding-right: 15px;\n}\n#vadStatus[data-v-3a451344]{\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  width: 100%;\n  max-width: 500px;  \n  height: 100px;\n  -ms-flex-item-align: center;\n      align-self: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n#vadStatus canvas[data-v-3a451344]{\n  z-index: 1;\n  display: block;\n  height: 100%;\n  width: 100%;\n  background-color: #333;\n}\n#vadStatus div[data-v-3a451344]{\n  height: 100%;\n  width: 100%;\n  border: 4px solid black;\n  border-radius: 4px;\n}\n#vadStatus.active div[data-v-3a451344]{\n  border-color: red;\n}\n#vadStatus.mobile[data-v-3a451344]{\n  height: 28px;\n  max-width: 150px;\n}\n#vadStatus.mobile div span[data-v-3a451344]{\n  display: block;\n  padding: 4px;\n}\n#vadStatus.mobile div[data-v-3a451344]{\n  color: white;\n  font-weight: 700;\n  background-color: black;\n}\n#vadStatus.mobile.active div[data-v-3a451344]{\n  background-color: red;\n}\n#startVAD[data-v-3a451344] {\n  z-index: 2;\n  -ms-flex-item-align: center;\n      align-self: center;\n  margin: 15px;\n  outline: none;\n  background-color: rgb(40,40,40);\n  color: white;\n  width: 80px;\n  height: 80px;\n  border: 2px solid black;\n  border-radius: 40px;\n  padding: 8px 16px;\n  cursor: pointer;\n}\n#startVAD [class*=fa][data-v-3a451344]{\n  font-size: 34px !important;\n}\n#startVAD.on[data-v-3a451344] {\n  background-color: rgba(255, 40, 40, 0.75);\n  border-color: rgb(200, 40, 40);\n}\n#startVAD.on.vad[data-v-3a451344] {\n  background-color: rgba(255, 40, 40, 1);\n}\n#startVAD.on .fa-microphone[data-v-3a451344]{\n  display: none;\n}\n#startVAD .fa-stop[data-v-3a451344], #startVAD .fa-spinner[data-v-3a451344]{\n  display: none;\n}\n#startVAD.on .fa-stop[data-v-3a451344]{\n  display: initial;\n}\n#startVAD.on.loading .fa-spinner[data-v-3a451344]{\n  display: initial;\n}\naudio[data-v-3a451344]{\n  outline: none;\n  width: 100%;\n  padding-bottom: 15px;\n}\n.audio[data-v-3a451344]{\n  padding: 0px 15px 0px 15px;\n}\ndiv.confidence[data-v-3a451344]{\n  display: -webkit-inline-box;\n  display: -ms-inline-flexbox;\n  display: inline-flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n}\ndiv.char[data-v-3a451344]{\n  /*line-height: 20px;*/\n}\ndiv.char-wrapper[data-v-3a451344]{\n  width: 20px;\n  display: inline-block;\n  text-align: center;\n}\ndiv.word[data-v-3a451344]{\n  margin-right: 20px;\n}\ndiv.word[data-v-3a451344]:last-child{\n  margin-right: 0px;\n}\ndiv.word-wrapper[data-v-3a451344]{\n  /*width: 20px*/\n}\nspan.char[data-v-3a451344]{\n  display: inline-block;\n  width: 20px;\n  text-align: center;\n}\nspan.prob[data-v-3a451344]{\n  display: inline-block;\n  font-size: 8px;\n  /*line-he*/ight: 0px;\n}\n","",{version:3,sources:["/Users/livestream/tehikudev/korero-maori-demos/vad-korero-demo/src/components/src/components/Korero.vue"],names:[],mappings:";AAmPA;EACA,oDAAA;EACA,oCAAA;EACA,mCAAA;EACA,mBAAA;EACA,eAAA;EACA,gBAAA;CACA;AACA;EACA,mBAAA;EACA,WAAA;EACA,SAAA;EACA,eAAA;EACA,YAAA;EACA,YAAA;EACA,iBAAA;EACA,eAAA;EACA,gBAAA;EACA,cAAA;EACA,iBAAA;CACA;AACA;EACA,mBAAA;EACA,YAAA;EACA,4BAAA;EACA,iBAAA;EACA,sBAAA;EACA,iBAAA;EACA,mBAAA;EACA,gDAAA;EACA,wBAAA;CACA;AACA;EACA,YAAA;CACA;AACA;EACA,mBAAA;CACA;AACA;EACA,iBAAA;CACA;AAEA;EACA,cAAA;CACA;AACA;EACA,qBAAA;EAAA,qBAAA;EAAA,cAAA;EACA,6BAAA;EAAA,8BAAA;MAAA,2BAAA;UAAA,uBAAA;EACA,yBAAA;MAAA,sBAAA;UAAA,wBAAA;CACA;AACA;EACA,cAAA;EACA,mBAAA;CACA;AACA;EACA,qBAAA;EACA,WAAA;EACA,wBAAA;EACA,mBAAA;EACA,oBAAA;CACA;AACA;EACA,WAAA;EACA,qBAAA;EAAA,qBAAA;EAAA,cAAA;EACA,6BAAA;EAAA,8BAAA;MAAA,2BAAA;UAAA,uBAAA;EACA,mBAAA;EACA,sBAAA;MAAA,kBAAA;EACA,kCAAA;EACA,6CAAA;EACA,0BAAA;MAAA,uBAAA;UAAA,oBAAA;EACA,kBAAA;EACA,cAAA;EACA,mBAAA;EACA,oBAAA;CACA;AAEA;EACA,qBAAA;EAAA,qBAAA;EAAA,cAAA;EACA,YAAA;EACA,iBAAA;EACA,cAAA;EACA,4BAAA;MAAA,mBAAA;EACA,0BAAA;MAAA,uBAAA;UAAA,oBAAA;CACA;AACA;EACA,WAAA;EACA,eAAA;EACA,aAAA;EACA,YAAA;EACA,uBAAA;CACA;AACA;EACA,aAAA;EACA,YAAA;EACA,wBAAA;EACA,mBAAA;CACA;AACA;EACA,kBAAA;CACA;AACA;EACA,aAAA;EACA,iBAAA;CACA;AACA;EACA,eAAA;EACA,aAAA;CACA;AACA;EACA,aAAA;EACA,iBAAA;EACA,wBAAA;CACA;AACA;EACA,sBAAA;CACA;AACA;EACA,WAAA;EACA,4BAAA;MAAA,mBAAA;EACA,aAAA;EACA,cAAA;EACA,gCAAA;EACA,aAAA;EACA,YAAA;EACA,aAAA;EACA,wBAAA;EACA,oBAAA;EACA,kBAAA;EACA,gBAAA;CACA;AACA;EACA,2BAAA;CACA;AACA;EACA,0CAAA;EACA,+BAAA;CACA;AACA;EACA,uCAAA;CACA;AACA;EACA,cAAA;CACA;AACA;EACA,cAAA;CACA;AACA;EACA,iBAAA;CACA;AACA;EACA,iBAAA;CACA;AACA;EACA,cAAA;EACA,YAAA;EACA,qBAAA;CACA;AACA;EACA,2BAAA;CACA;AAEA;EACA,4BAAA;EAAA,4BAAA;EAAA,qBAAA;EACA,oBAAA;MAAA,gBAAA;CACA;AACA;EACA,sBAAA;CACA;AACA;EACA,YAAA;EACA,sBAAA;EACA,mBAAA;CACA;AACA;EACA,mBAAA;CACA;AACA;EACA,kBAAA;CACA;AACA;EACA,eAAA;CACA;AACA;EACA,sBAAA;EACA,YAAA;EACA,mBAAA;CACA;AACA;EACA,sBAAA;EACA,eAAA;EACA,WAAA,UAAA;CACA",file:"Korero.vue",sourcesContent:['<template>\n  <div class="Korero">\n    <div class="header">\n      <button id="startVAD" v-bind:class="{ vad: vadOn, on: recordingOn, \'loading\': loadRecording}">\n        <i class="fa fa-microphone" ></i>\n        <i class="fa fa-stop" ></i>\n        <i class="fa fa-spinner fa-spin"></i>\n      </button>\n      <div id="vadStatus" v-bind:class="{ active: vadOn, \'mobile\': isMobile()}">\n        <div>\n          <canvas id="canvas" v-if="!isMobile()"></canvas>\n          <span v-if="isMobile() && vadOn && recordingOn">Voice Detected</span>\n          <span v-if="isMobile() && recordingOn && !vadOn">Listening</span>\n          <span v-if="isMobile()">Hit Record</span>\n        </div>\n      </div>\n    </div>\n\n    <div class="body">\n      <div id="transcriptions">\n        <div v-for="(item, index) in transcriptions" class=\'transcription\' v-bind:class="[item.status]" v-if="item.status != \'Failed\'"> \n          <button class="delete" v-if="item.status != \'Transcribing\'" v-on:click="deleteObject(index)"><i class="fa fa-times"></i></button>\n          <div class=\'text\'>\n            <i class="fa fa-spinner fa-spin" v-bind:class="[item.status]" v-if="item.status == \'Transcribing\'" ></i>\n            <div v-if="item.show_metadata">\n              <div class=\'confidence\'>\n                <div class="char" v-for="character in item.metadata">\n                  <div class="char-wrapper" v-if="character.char==\' \'"\n                       :style="{backgroundColor: `rgb(255, 40, 40, ${1-character.prob})`}">\n                       <span class="char">&nbsp;&nbsp;</span>\n                       <br><span class="prob">&nbsp;{{character.prob.toFixed(2)}}&nbsp;</span>\n                  </div>\n                  <div class="char-wrapper" v-if="character.char!=\' \'"\n                       :style="{\n                          backgroundColor: `rgba(255, 40, 40, ${1-character.prob})`\n                        }">\n                      <span class="char">{{character.char}}</span>\n                      <br><span class="prob">&nbsp;{{character.prob.toFixed(2)}}&nbsp;</span>\n                  </div>\n                </div>\n              </div>\n              <div><br></div>\n              <div class=\'confidence\'>          \n                <div class="char" v-for="character in item.metadata">\n                  <div class="char-wrapper" v-if="character.acoustic==\' \'"\n                       :style="{backgroundColor: `rgb(255, 40, 40, ${character.entropy})`}">\n                       <span class="char">&nbsp;&nbsp;</span>\n                       <br><span class="prob">&nbsp;{{character.entropy.toFixed(2)}}&nbsp;</span>\n                  </div>\n                  <div class="char-wrapper" v-if="character.acoustic!=\' \'"\n                       :style="{\n                          backgroundColor: `rgba(255, 40, 40, ${character.entropy})`\n                        }">\n                      <span class="char">{{character.acoustic}}</span>\n                      <br><span class="prob">&nbsp;{{character.entropy.toFixed(2)}}&nbsp;</span>\n                  </div>\n                </div>\n              </div>\n              <div><br></div>\n              <div class=\'confidence\'>          \n                <div class="word" v-for="word in item.words"\n                  :style="{\n                      backgroundColor: `rgba(255, 40, 40, ${1-word.prob})`\n                    }">\n                  <div class="word-wrapper" \n                    >\n                      <span class="char" v-for="char in word.word" v-if="char != \' \'">{{char}}</span>\n                      \n                  </div><span class="prob">{{word.prob.toFixed(2)}}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div v-if="!item.show_metadata">\n            <div class=\'text\' v-if="item.status != \'Transcribing\'">{{item.text}}</div>\n          </div>\n          <div class="audio">\n            <audio v-if="item.audio_url" :src="item.audio_url" type="audio/mp3" controls v-on:play="stopRecording"></audio>\n          </div>\n\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport recorder from \'../lib/recorder.js\'\nconst ApiAuth = require(\'../../api_auth\')\nconst api_auth = ApiAuth.api_auth;\nconst axios = require(\'axios\');\nexport default {\n  name: \'Kōrero\',\n  data () {\n    return {\n      vadOn: false,\n      recordingOn: false,\n      recorder: null,\n      buttonText: \'Start\',\n      transcriptions: [],\n      icon: \'fa-microphone\',\n      loadRecording: false\n    }\n  },\n  methods: {\n    deleteObject: function (e) {\n      this.transcriptions.splice(e, 1)\n    },\n    stopRecording: function () {\n      try{this.recorder.stop();}\n      catch(e){}\n      this.recorder=null;\n      this.vadOn = false;\n      this.recordingOn = false\n    },   \n    isMobile() {\n      if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Mobile|SamsungBrowser|Opera Mini/i.test(navigator.userAgent)) {\n        console.log(navigator.userAgent)\n        return true\n      } else {\n        return false\n      }\n    },\n    p_not_word: function(n, probabilities){\n      if (n == 0){\n        return 0\n      }                                                                \n      else {\n        return probabilities[n - 1] * this.p_not_word(n - 1, probabilities) + (1 - probabilities[n - 1])\n      }\n    },\n    p_word: function(probabilities){\n      return 1 - this.p_not_word(probabilities.length, probabilities)      \n    },\n\n  },\n  mounted: function () {\n\n    startVAD.onclick = event => {\n\n      if (this.recorder==null){\n        this.loadRecording = true\n        this.recorder = new recorder({\n          putRecording : (record) => {\n            var transcription = {\n              status: \'Transcribing\',\n              text: null,\n              audio: null,\n            }\n            this.transcriptions.unshift(transcription)\n            var formData = new FormData();\n            formData.enctype="multipart/form-data";\n            formData.append(\'audio_file\', record.blob, \'audio_file.mp3\')            \n            axios.post(\n              api_auth[\'url\'],\n              formData,\n              {\n                headers: api_auth[\'headers\'],\n              })\n            .then((response) => {\n              if (response.data.transcription == \'\' || response.data.transcription == \' \' ){\n                transcription.status = \'Failed\'\n                return\n              }\n              transcription[\'text\'] = response.data.transcription\n              transcription[\'show_metadata\'] = false\n              if (response.data.metadata){\n                transcription[\'show_metadata\'] = true\n                transcription[\'metadata\'] = response.data.metadata\n\n                var words = []\n                var probs = []\n                var prob = []\n                var word = \'\'\n                var start = 0\n                for (var i=0; i <response.data.metadata.length; i++){\n                  word = word + response.data.metadata[i].char\n                  prob.push(response.data.metadata[i].prob)\n                  if (response.data.metadata[i].char != \' \'){\n                    continue\n                  } else {\n                    words.push({\'word\': word, \'prob\': this.p_word(prob)})\n                    prob = []\n                    start = i\n                    word = \'\'\n                  }\n                }\n                words.push({\'word\': word, \'prob\': this.p_word(prob)})\n                console.log(words)\n                transcription[\'words\'] = words\n                console.log(transcription[\'metadata\'])\n              }\n              \n              transcription[\'audio_url\'] = record.url\n              transcription[\'status\'] = \'Success\'\n            })\n            .catch((error) => {\n              transcription.status = \'Failed\'\n            })\n\n          },\n          afterRecording  : (stream) =>{\n            this.buttonText = \'Start\'            \n            this.recorder=null;\n          },\n          pauseRecording  : function(){console.log(\'paused\')},\n          micFailed       : function(){console.log(\'failed\')},\n          voiceStop: () => {\n            \n            this.vadOn = false\n          },\n          voiceStart: () => {\n            this.vadOn = true\n\n          },\n          canvasID: this.isMobile() ? null : \'canvas\',\n          bitRate         : 64,\n          sampleRate      : 44100,\n          // format          : this.format\n        })\n      }\n\n      if (this.recordingOn){\n        this.recorder.stop();\n        this.recorder=null;\n        this.vadOn = false;\n        this.recordingOn = false\n        // this.buttonText = \'Start\'\n      } else {\n        this.recorder.start()\n        this.recordingOn = true\n        this.buttonText = \'Stop\'\n        this.loadRecording = false\n      }\n      \n\n      }\n  }\n}\n<\/script>\n\n<style scoped>\n\n.Korero {\n  font-family: \'Avenir\', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  font-size: 14px;\n}\nbutton.delete{\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  display: block;\n  border: 0px;\n  margin: 2px;\n  font-size: 0.7em;\n  color: #696969;\n  cursor: pointer;\n  outline: none;\n  background: none;\n}\n.transcription{\n  position: relative;\n  width: 100%;\n  margin: 20px 30px 20px 30px;\n  max-width: 500px;\n  /*margin-top: 20px; */\n  font-size: 1.5em;\n  border-radius: 8px;\n  /*box-shadow: 0px 2px 6px -2px rgba(0,0,0,1)  */\n  border: 1px solid black;\n}\n.transcription.Transcribing{\n  border: 0px;\n}\n.transcription .text {\n  padding: 15px 20px;\n}\n.transcription:nth-of-type(1){\n  margin-top: 40px;\n}\n\ndiv.transcription.Success div.text [class*=fa]{\n  display: none;\n}\n.Korero, .header, .body{\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.body{\n  height: 100vh;\n  margin-top: -225px;\n}\n.header{\n  padding-bottom: 15px;\n  z-index: 1;\n  background-color: white;\n  padding-left: 15px;\n  padding-right: 15px;  \n}\n#transcriptions{\n  z-index: 0;\n  display: flex;\n  flex-direction: column;\n  overflow-y: scroll;\n  flex-wrap: nowrap;\n  -webkit-overflow-scrolling: touch;\n  -ms-overflow-style: -ms-autohiding-scrollbar; \n  align-items: center;  \n  margin-top: 232px;\n  height: 100vh;    \n  padding-left: 15px;\n  padding-right: 15px;\n}\n\n#vadStatus{\n  display: flex;\n  width: 100%;\n  max-width: 500px;  \n  height: 100px;\n  align-self: center;\n  align-items: center;\n}\n#vadStatus canvas{\n  z-index: 1;\n  display: block;\n  height: 100%;\n  width: 100%;\n  background-color: #333;\n}\n#vadStatus div{\n  height: 100%;\n  width: 100%;\n  border: 4px solid black;\n  border-radius: 4px;\n}\n#vadStatus.active div{\n  border-color: red;\n}\n#vadStatus.mobile{\n  height: 28px;\n  max-width: 150px;  \n}\n#vadStatus.mobile div span{\n  display: block;\n  padding: 4px;\n}\n#vadStatus.mobile div{\n  color: white;\n  font-weight: 700;\n  background-color: black;\n}\n#vadStatus.mobile.active div{\n  background-color: red;\n}\n#startVAD {\n  z-index: 2;\n  align-self: center;\n  margin: 15px;\n  outline: none;\n  background-color: rgb(40,40,40);\n  color: white;\n  width: 80px;\n  height: 80px;\n  border: 2px solid black;\n  border-radius: 40px;\n  padding: 8px 16px;\n  cursor: pointer;\n}\n#startVAD [class*=fa]{\n  font-size: 34px !important;\n}\n#startVAD.on {\n  background-color: rgba(255, 40, 40, 0.75);\n  border-color: rgb(200, 40, 40);\n}\n#startVAD.on.vad {\n  background-color: rgba(255, 40, 40, 1);\n}\n#startVAD.on .fa-microphone{\n  display: none;\n}\n#startVAD .fa-stop, #startVAD .fa-spinner{\n  display: none;\n}\n#startVAD.on .fa-stop{\n  display: initial;\n}\n#startVAD.on.loading .fa-spinner{\n  display: initial;\n}\naudio{\n  outline: none;\n  width: 100%;\n  padding-bottom: 15px;\n}\n.audio{\n  padding: 0px 15px 0px 15px;\n}\n\ndiv.confidence{\n  display: inline-flex;\n  flex-wrap: wrap;\n}\ndiv.char{\n  /*line-height: 20px;*/\n}\ndiv.char-wrapper{\n  width: 20px;\n  display: inline-block;\n  text-align: center;\n}\ndiv.word{\n  margin-right: 20px;\n}\ndiv.word:last-child{\n  margin-right: 0px;\n}\ndiv.word-wrapper{\n  /*width: 20px*/\n}\nspan.char{\n  display: inline-block;\n  width: 20px;\n  text-align: center;\n}\nspan.prob{\n  display: inline-block;\n  font-size: 8px;\n  /*line-he*/ight: 0px;\n}\n</style>\n'],sourceRoot:""}])},BLBT:function(n,t,i){api_auth={headers:{},url:"/api/transcription/?method=stream"},t.api_auth=api_auth},NHnr:function(n,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=i("7+uW"),a=i("Zrlr"),r=i.n(a),s=i("wxAW"),o=i.n(s),A=i("n0CH"),c=function(){function n(t){r()(this,n),this.bitRate=t.bitRate||96,this.sampleRate=t.sampleRate||44100,this.dataBuffer=[],this.encoder=new A.Mp3Encoder(1,this.sampleRate,this.bitRate)}return o()(n,[{key:"flushPrevious",value:function(n){this.dataBuffer=this.dataBuffer.slice(this.dataBuffer.length-n)}},{key:"encode",value:function(n){for(var t=this._convertBuffer(n),i=t.length,e=0;i>=0;e+=1152){var a=t.subarray(e,e+1152),r=this.encoder.encodeBuffer(a);this.dataBuffer.push(new Int8Array(r)),i-=1152}}},{key:"finish",value:function(){this.dataBuffer.push(this.encoder.flush());var n=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:n,url:URL.createObjectURL(n)}}},{key:"_floatTo16BitPCM",value:function(n,t){for(var i=0;i<n.length;i++){var e=Math.max(-1,Math.min(1,n[i]));t[i]=e<0?32768*e:32767*e}}},{key:"_convertBuffer",value:function(n){var t=new Float32Array(n),i=new Int16Array(n.length);return this._floatTo16BitPCM(t,i),i}}]),n}(),d=i("ZdGo"),l=function n(t){for(var i in r()(this,n),this.options={fftSize:256,bufferLen:256,voice_stop:function(){},voice_start:function(){},smoothingTimeConstant:.99,energy_offset:1e-8,energy_threshold_ratio_pos:4,energy_threshold_ratio_neg:.25,energy_integration:1,filter:[{f:200,v:0},{f:2e3,v:1}],source:null,context:null,debug:!1},t)t.hasOwnProperty(i)&&(this.options[i]=t[i]);if(!this.options.source)throw new Error("The options must specify a MediaStreamAudioSourceNode.");this.options.context=this.options.source.context,this.hertzPerBin=this.options.context.sampleRate/this.options.fftSize,this.iterationFrequency=this.options.context.sampleRate/this.options.bufferLen,this.iterationPeriod=1/this.iterationFrequency,this.options.debug&&console.log("Vad | sampleRate: "+this.options.context.sampleRate+" | hertzPerBin: "+this.hertzPerBin+" | iterationFrequency: "+this.iterationFrequency+" | iterationPeriod: "+this.iterationPeriod),this.setFilter=function(n){this.filter=[];for(var t=0,i=this.options.fftSize/2;t<i;t++){this.filter[t]=0;for(var e=0,a=n.length;e<a;e++)if(t*this.hertzPerBin<n[e].f){this.filter[t]=n[e].v;break}}},this.setFilter(this.options.filter),this.ready={},this.vadState=!1,this.energy_offset=this.options.energy_offset,this.energy_threshold_pos=this.energy_offset*this.options.energy_threshold_ratio_pos,this.energy_threshold_neg=this.energy_offset*this.options.energy_threshold_ratio_neg,this.voiceTrend=0,this.voiceTrendMax=15,this.voiceTrendMin=-5,this.voiceTrendStart=2,this.voiceTrendEnd=-5,this.damper=.02,this.voiceTrendMin=this.voiceTrendEnd-this.damper/10,this.analyser=this.options.context.createAnalyser(),this.analyser.smoothingTimeConstant=this.options.smoothingTimeConstant,this.analyser.fftSize=this.options.fftSize,this.floatFrequencyData=new Float32Array(this.analyser.frequencyBinCount),this.floatFrequencyDataLinear=new Float32Array(this.floatFrequencyData.length),this.options.source.connect(this.analyser),this.scriptProcessorNode=this.options.context.createScriptProcessor(this.options.bufferLen,1,1),this.scriptProcessorNode.connect(this.options.context.destination);var e=this;this.scriptProcessorNode.onaudioprocess=function(n){e.analyser.getFloatFrequencyData(e.floatFrequencyData),e.update(),e.monitor()},this.options.source.connect(this.scriptProcessorNode),this.logging=!1,this.log_i=0,this.log_limit=100,this.triggerLog=function(n){this.logging=!0,this.log_i=0,this.log_limit="number"==typeof n?n:this.log_limit},this.log=function(n){this.logging&&this.log_i<this.log_limit?(this.log_i++,console.log(n)):this.logging=!1},this.update=function(){for(var n=this.floatFrequencyData,t=0,i=n.length;t<i;t++)this.floatFrequencyDataLinear[t]=Math.pow(10,n[t]/10);this.ready={}},this.getEnergy=function(){if(this.ready.energy)return this.energy;for(var n=0,t=this.floatFrequencyDataLinear,i=0,e=t.length;i<e;i++)n+=this.filter[i]*t[i]*t[i];return this.energy=n,this.ready.energy=!0,n},this.monitor=function(){var n=this.getEnergy(),t=n-this.energy_offset;t>this.energy_threshold_pos?this.voiceTrend=this.voiceTrend+1>this.voiceTrendMax?this.voiceTrendMax:this.voiceTrend+1:t<-this.energy_threshold_neg?this.voiceTrend=this.voiceTrend-1<this.voiceTrendMin?this.voiceTrendMin:this.voiceTrend-1*(this.vadState?this.damper:10):this.voiceTrend>0?this.voiceTrend--:this.voiceTrend<0&&this.voiceTrend++;var i=!1,e=!1;this.voiceTrend>this.voiceTrendStart?i=!0:this.voiceTrend<this.voiceTrendEnd&&(e=!0);var a=t*this.iterationPeriod*this.options.energy_integration;return this.energy_offset+=a>0||!e?a:10*a,this.energy_offset=this.energy_offset<0?0:this.energy_offset,this.energy_threshold_pos=this.energy_offset*this.options.energy_threshold_ratio_pos,this.energy_threshold_neg=this.energy_offset*this.options.energy_threshold_ratio_neg,i&&!this.vadState&&(this.vadState=!0,this.options.voice_start()),e&&this.vadState&&(this.vadState=!1,this.options.voice_stop()),this.log("e: "+n+" | e_of: "+this.energy_offset+" | e+_th: "+this.energy_threshold_pos+" | e-_th: "+this.energy_threshold_neg+" | signal: "+t+" | int: "+a+" | voiceTrend: "+this.voiceTrend+" | start: "+i+" | end: "+e),t}},h=function(){function n(t,i,e){r()(this,n);this.canvas=document.getElementById(t),this.canvasContext=this.canvas.getContext("2d"),this.loop=!1,this.sourceNode=i,this.audioContext=e,this.analyser=e.createAnalyser(),this.analyser.fftSize=32,this.sourceNode.connect(this.analyser),this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.analyser.fftSize)}return o()(n,[{key:"stop",value:function(){this.loop=!1;var n=this;window.setTimeout(function(){n.clearFrame()},200)}},{key:"start",value:function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.WIDTH=this.canvas.clientWidth,this.HEIGHT=this.canvas.clientHeight,this.loop=!0,this.renderFrame()}},{key:"renderFrame",value:function(){var n=this;if(n.loop){window.requestAnimationFrame(function(){n.renderFrame()}),n.analyser.getByteFrequencyData(n.dataArray),n.canvasContext.fillStyle="#333",n.canvasContext.fillRect(0,0,n.WIDTH,n.HEIGHT);for(var t=parseInt(n.WIDTH/n.bufferLength),i=0,e=0,a=0;a<n.bufferLength/2;a++){i=parseInt(n.dataArray[a]/255*n.HEIGHT*.9);var r=parseInt(n.HEIGHT/i*.5*73),s=parseInt(i/n.HEIGHT*90);n.canvasContext.fillStyle="hsl(345,"+r+"%,"+s+"%)",n.canvasContext.fillRect(2*e+1,n.HEIGHT-i,2*t-2,i),e+=t}}}},{key:"clearFrame",value:function(){this.canvasContext.clearRect(0,0,this.WIDTH,this.HEIGHT),this.canvasContext.fillStyle="#333",this.canvasContext.fillRect(0,0,this.WIDTH,this.HEIGHT)}}]),n}(),p=function(){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,n),this.beforeRecording=t.beforeRecording,this.pauseRecording=t.pauseRecording,this.putRecording=t.putRecording,this.afterRecording=t.afterRecording,this.micFailed=t.micFailed,this.voiceStop=t.voiceStop,this.voiceStart=t.voiceStart,this.visCanvasID=t.canvasID||null,this.bitRate=t.bitRate||96,this.sampleRate=t.sampleRate||44100,this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0,this.vad=null,this.vis=null,this.activity=!1,this.flush=!1,this.vis=null,this.context=new(window.AudioContext||window.webkitAudioContext),this.sampleRate=this.context.sampleRate,this.context.close()}return o()(n,[{key:"start",value:function(){this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia({video:!1,audio:{channelCount:1,echoCancellation:!0}}).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder=new c({bitRate:this.bitRate,sampleRate:this.sampleRate})}},{key:"stop",value:function(){this.vis&&this.vis.stop(),this.stream.getTracks().forEach(function(n){return n.stop()}),this.input.disconnect(),this.processor.disconnect(),this.context.close();var n=this.lameEncoder.finish();n.duration=Object(d.a)(this.duration),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(n)}},{key:"put",value:function(){this.stream.getTracks().forEach(function(n){return n.stop()}),this.input.disconnect(),this.processor.disconnect(),this.context.close();var n=this.lameEncoder.finish();n.duration=Object(d.a)(this.duration),this.records.push(n),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.putRecording&&this.putRecording(n)}},{key:"pause",value:function(){this.stream.getTracks().forEach(function(n){return n.stop()}),this.input.disconnect(),this.processor.disconnect(),this.context.close(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}},{key:"recordList",value:function(){return this.records}},{key:"lastRecord",value:function(){return this.records.slice(-1)}},{key:"_micCaptured",value:function(n){var t=this;this.context=new(window.AudioContext||window.webkitAudioContext)({sampleRate:this.sampleRate}),this.duration=this._duration,this.input=this.context.createMediaStreamSource(n),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=n,this._voiceStop=function(){t.voiceStop(),t.activity=!1,t.put(),t.start()},this._voiceStart=function(){t.voiceStart(),t.activity=!0,t.flush=!0};var i={debug:!1,source:this.input,voice_stop:this._voiceStop,voice_start:this._voiceStart};if(this.vad=new l(i),this.visCanvasID)try{this.vis=new h(this.visCanvasID,this.input,this.input.context),this.vis.start()}catch(n){console.log(n)}this.processor.onaudioprocess=function(n){t.activity&&t.flush&&(t.lameEncoder.flushPrevious(15),t.flush=!1);var i=n.inputBuffer.getChannelData(0),e=0;t.lameEncoder.encode(i);for(var a=0;a<i.length;++a)e+=i[a]*i[a];t.duration=parseFloat(t._duration)+parseFloat(t.context.currentTime.toFixed(2)),t.volume=Math.sqrt(e/i.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"_micError",value:function(n){this.micFailed&&this.micFailed(n)}}]),n}(),u=i("BLBT").api_auth,v=i("mtWM"),f={name:"Kōrero",data:function(){return{vadOn:!1,recordingOn:!1,recorder:null,buttonText:"Start",transcriptions:[],icon:"fa-microphone",loadRecording:!1}},methods:{deleteObject:function(n){this.transcriptions.splice(n,1)},stopRecording:function(){try{this.recorder.stop()}catch(n){}this.recorder=null,this.vadOn=!1,this.recordingOn=!1},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Mobile|SamsungBrowser|Opera Mini/i.test(navigator.userAgent)&&(console.log(navigator.userAgent),!0)},p_not_word:function(n,t){return 0==n?0:t[n-1]*this.p_not_word(n-1,t)+(1-t[n-1])},p_word:function(n){return 1-this.p_not_word(n.length,n)}},mounted:function(){var n=this;startVAD.onclick=function(t){null==n.recorder&&(n.loadRecording=!0,n.recorder=new p({putRecording:function(t){var i={status:"Transcribing",text:null,audio:null};n.transcriptions.unshift(i);var e=new FormData;e.enctype="multipart/form-data",e.append("audio_file",t.blob,"audio_file.mp3"),v.post(u.url,e,{headers:u.headers}).then(function(e){if(""!=e.data.transcription&&" "!=e.data.transcription){if(i.text=e.data.transcription,i.show_metadata=!1,e.data.metadata){i.show_metadata=!0,i.metadata=e.data.metadata;for(var a=[],r=[],s="",o=0;o<e.data.metadata.length;o++)s+=e.data.metadata[o].char,r.push(e.data.metadata[o].prob)," "==e.data.metadata[o].char&&(a.push({word:s,prob:n.p_word(r)}),r=[],o,s="");a.push({word:s,prob:n.p_word(r)}),console.log(a),i.words=a,console.log(i.metadata)}i.audio_url=t.url,i.status="Success"}else i.status="Failed"}).catch(function(n){i.status="Failed"})},afterRecording:function(t){n.buttonText="Start",n.recorder=null},pauseRecording:function(){console.log("paused")},micFailed:function(){console.log("failed")},voiceStop:function(){n.vadOn=!1},voiceStart:function(){n.vadOn=!0},canvasID:n.isMobile()?null:"canvas",bitRate:64,sampleRate:44100})),n.recordingOn?(n.recorder.stop(),n.recorder=null,n.vadOn=!1,n.recordingOn=!1):(n.recorder.start(),n.recordingOn=!0,n.buttonText="Stop",n.loadRecording=!1)}}},g=function(){var n=this,t=n.$createElement,i=n._self._c||t;return i("div",{staticClass:"Korero"},[i("div",{staticClass:"header"},[i("button",{class:{vad:n.vadOn,on:n.recordingOn,loading:n.loadRecording},attrs:{id:"startVAD"}},[i("i",{staticClass:"fa fa-microphone"}),n._v(" "),i("i",{staticClass:"fa fa-stop"}),n._v(" "),i("i",{staticClass:"fa fa-spinner fa-spin"})]),n._v(" "),i("div",{class:{active:n.vadOn,mobile:n.isMobile()},attrs:{id:"vadStatus"}},[i("div",[n.isMobile()?n._e():i("canvas",{attrs:{id:"canvas"}}),n._v(" "),n.isMobile()&&n.vadOn&&n.recordingOn?i("span",[n._v("Voice Detected")]):n._e(),n._v(" "),n.isMobile()&&n.recordingOn&&!n.vadOn?i("span",[n._v("Listening")]):n._e(),n._v(" "),n.isMobile()?i("span",[n._v("Hit Record")]):n._e()])])]),n._v(" "),i("div",{staticClass:"body"},[i("div",{attrs:{id:"transcriptions"}},n._l(n.transcriptions,function(t,e){return"Failed"!=t.status?i("div",{staticClass:"transcription",class:[t.status]},["Transcribing"!=t.status?i("button",{staticClass:"delete",on:{click:function(t){return n.deleteObject(e)}}},[i("i",{staticClass:"fa fa-times"})]):n._e(),n._v(" "),i("div",{staticClass:"text"},["Transcribing"==t.status?i("i",{staticClass:"fa fa-spinner fa-spin",class:[t.status]}):n._e(),n._v(" "),t.show_metadata?i("div",[i("div",{staticClass:"confidence"},n._l(t.metadata,function(t){return i("div",{staticClass:"char"},[" "==t.char?i("div",{staticClass:"char-wrapper",style:{backgroundColor:"rgb(255, 40, 40, "+(1-t.prob)+")"}},[i("span",{staticClass:"char"},[n._v("  ")]),n._v(" "),i("br"),i("span",{staticClass:"prob"},[n._v(" "+n._s(t.prob.toFixed(2))+" ")])]):n._e(),n._v(" ")," "!=t.char?i("div",{staticClass:"char-wrapper",style:{backgroundColor:"rgba(255, 40, 40, "+(1-t.prob)+")"}},[i("span",{staticClass:"char"},[n._v(n._s(t.char))]),n._v(" "),i("br"),i("span",{staticClass:"prob"},[n._v(" "+n._s(t.prob.toFixed(2))+" ")])]):n._e()])}),0),n._v(" "),n._m(0,!0),n._v(" "),i("div",{staticClass:"confidence"},n._l(t.metadata,function(t){return i("div",{staticClass:"char"},[" "==t.acoustic?i("div",{staticClass:"char-wrapper",style:{backgroundColor:"rgb(255, 40, 40, "+t.entropy+")"}},[i("span",{staticClass:"char"},[n._v("  ")]),n._v(" "),i("br"),i("span",{staticClass:"prob"},[n._v(" "+n._s(t.entropy.toFixed(2))+" ")])]):n._e(),n._v(" ")," "!=t.acoustic?i("div",{staticClass:"char-wrapper",style:{backgroundColor:"rgba(255, 40, 40, "+t.entropy+")"}},[i("span",{staticClass:"char"},[n._v(n._s(t.acoustic))]),n._v(" "),i("br"),i("span",{staticClass:"prob"},[n._v(" "+n._s(t.entropy.toFixed(2))+" ")])]):n._e()])}),0),n._v(" "),n._m(1,!0),n._v(" "),i("div",{staticClass:"confidence"},n._l(t.words,function(t){return i("div",{staticClass:"word",style:{backgroundColor:"rgba(255, 40, 40, "+(1-t.prob)+")"}},[i("div",{staticClass:"word-wrapper"},n._l(t.word,function(t){return" "!=t?i("span",{staticClass:"char"},[n._v(n._s(t))]):n._e()}),0),i("span",{staticClass:"prob"},[n._v(n._s(t.prob.toFixed(2)))])])}),0)]):n._e()]),n._v(" "),t.show_metadata?n._e():i("div",["Transcribing"!=t.status?i("div",{staticClass:"text"},[n._v(n._s(t.text))]):n._e()]),n._v(" "),i("div",{staticClass:"audio"},[t.audio_url?i("audio",{attrs:{src:t.audio_url,type:"audio/mp3",controls:""},on:{play:n.stopRecording}}):n._e()])]):n._e()}),0)])])};g._withStripped=!0;var b={render:g,staticRenderFns:[function(){var n=this.$createElement,t=this._self._c||n;return t("div",[t("br")])},function(){var n=this.$createElement,t=this._self._c||n;return t("div",[t("br")])}]},C=b;var m=!1;var x=i("VU/8")(f,C,!1,function(n){m||i("SVQq")},"data-v-3a451344",null);x.options.__file="src/components/Korero.vue";var _=x.exports,y=i("PXmv");e.a.use(y.a),e.a.customElement("vue-widget",_)},SVQq:function(n,t,i){var e=i("4fnQ");"string"==typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);i("rjj0")("4b848445",e,!1,{})}},["NHnr"]);
//# sourceMappingURL=app.6664.js.map